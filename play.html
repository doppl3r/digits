<html>
	<head>
		<meta charset="utf-8">
		<title>Digits</title>
		<meta name="author" content="jacob debenedetto">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="format-detection" content="telephone=no">
		<link rel='shortcut icon' type='image/x-icon' href='img/favicon.ico' />
		<link href="css/stylesheet.css" rel="stylesheet" type="text/css" />
	</head>
	<body>
		<div class="grid">
			<div class="area logo"><h4><a href="index.html">digits</a></h4></div>
			<div class="area menu"><a href="exit.html" class="menu-button"><span class="menu-icon"></span></a></div>
			<div class="area title-2"><p>Begin memorizing</p></div>
			<div class="area input-1"><input disabled></div>
			<div class="area rounds"></div>
			<div class="area listen"><img src="img/listen.svg"></div>
			<div class="area clock"><img src="img/clock.svg"></div>
		</div>
		<audio id="audio-0" ><source src="audio/0.ogg" type="audio/ogg"><source src="audio/0.mp3" type="audio/mpeg"></audio>
		<audio id="audio-1" ><source src="audio/1.ogg" type="audio/ogg"><source src="audio/1.mp3" type="audio/mpeg"></audio>
		<audio id="audio-2" ><source src="audio/2.ogg" type="audio/ogg"><source src="audio/2.mp3" type="audio/mpeg"></audio>
		<audio id="audio-3" ><source src="audio/3.ogg" type="audio/ogg"><source src="audio/3.mp3" type="audio/mpeg"></audio>
		<audio id="audio-4" ><source src="audio/4.ogg" type="audio/ogg"><source src="audio/4.mp3" type="audio/mpeg"></audio>
		<audio id="audio-5" ><source src="audio/5.ogg" type="audio/ogg"><source src="audio/5.mp3" type="audio/mpeg"></audio>
		<audio id="audio-6" ><source src="audio/6.ogg" type="audio/ogg"><source src="audio/6.mp3" type="audio/mpeg"></audio>
		<audio id="audio-7" ><source src="audio/7.ogg" type="audio/ogg"><source src="audio/7.mp3" type="audio/mpeg"></audio>
		<audio id="audio-8" ><source src="audio/8.ogg" type="audio/ogg"><source src="audio/8.mp3" type="audio/mpeg"></audio>
		<audio id="audio-1" ><source src="audio/9.ogg" type="audio/ogg"><source src="audio/9.mp3" type="audio/mpeg"></audio>
		<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
		<script type="text/javascript" src="js/anime.min.js"></script>
		<script>
			$( document ).ready(function() { 
				//declare local data
				var type = localStorage.getItem('type');
				var direction = localStorage.getItem('direction');
				var output = localStorage.getItem('output');
				var rounds = parseInt(localStorage.getItem('rounds'));
				var currentRound = parseInt(localStorage.getItem('currentRound'));
				var correctString = ""; //this will be set by options
				var input = $('.input-1 input');

				//initialize gamemode based on user options
				function play(){
					renderRounds();
					if (output == 'visual' && direction == 'forward'){
						correctString = createString(6); //number based on user progress
						input.val(correctString); //add new string
						setTimeout(function(){ updateInput(); }, 5000);
					}
					else if (output == 'visual' && direction == 'backwards'){
						correctString = createString(4); //number based on user progress
						input.fadeTo(0, 0); //set alpha to 0 immediately
						$('.clock').fadeTo(0,0); //hide clock
						var i = 0; //current char index
						var interval = setInterval(function(){
							if (i < correctString.length){ 
								input.fadeTo(100, 1, function(){ input.fadeTo(900, 0); }); //blink alpha
								input.val(correctString.charAt(i));
								i++;
							}
							else { 
								input.fadeTo(0, 1); //set alpha to 1 immediately
								correctString = correctString.split("").reverse().join("");
								clearInterval(interval); //stop interval
								updateInput(); 
							}
						}, 1000);
					}
					else if (output == 'audio' && direction == 'forward'){
						correctString = createString(4); //number based on user progress
						$('.listen img').fadeTo(0, 0); //set alpha to 0 immediately
						$('.clock').fadeTo(0,0); //hide clock
						var i = 0; //current char index
						var interval = setInterval(function(){
							if (i < correctString.length){ 
								$('.listen img').fadeTo(100, 1, function(){ $('.listen img').fadeTo(900, 0); }); //blink alpha
								$('#audio-'+correctString.charAt(i))[0].play();
								i++;
							}
							else { 
								$('.listen img').fadeTo(0, 0); //set alpha to 1 immediately
								input.fadeTo(0, 1); //set alpha to 1 immediately
								clearInterval(interval); //stop interval
								updateInput(); 
							}
						}, 1000);
					}
					else if (output == 'audio' && direction == 'backwards'){
						correctString = createString(4); //number based on user progress
						$('.listen img').fadeTo(0, 0); //set alpha to 0 immediately
						$('.clock').fadeTo(0,0); //hide clock
						var i = 0; //current char index
						var interval = setInterval(function(){
							if (i < correctString.length){ 
								$('.listen img').fadeTo(100, 1, function(){ $('.listen img').fadeTo(900, 0); }); //blink alpha
								$('#audio-'+correctString.charAt(i))[0].play();
								i++;
							}
							else { 
								input.fadeTo(0, 1); //set alpha to 1 immediately
								correctString = correctString.split("").reverse().join("");
								clearInterval(interval); //stop interval
								updateInput();
							}
						}, 1000);
					}
				}
				
				//create a new string
				function createString(length){ //create number or letter string based on options
					var text = "";
					var numType = localStorage.getItem('type') == 'numbers'; //isNum
					var possible = numType ? '0123456789' : 'abcdefghijklmnopqrstuvwxyz';
					input.attr('type', numType ? 'number' : 'text'); //edit input type
					for (var i=0; i < length; i++) text+= possible.charAt(Math.floor(Math.random() * possible.length));
					return text;
				}

				function renderRounds(){
					//render HTML rounds 'checkboxes' null, correct, or incorrect
					for (var i=0; i < rounds; i++){
						var roundList = localStorage.getItem('roundList');
						if (roundList.charAt(i) == "0") $('.rounds').append('<img src="img/checkbox.svg">');
						else if (roundList.charAt(i) == "1") $('.rounds').append('<img src="img/checkbox-correct.svg">');
						else if (roundList.charAt(i) == "2") $('.rounds').append('<img src="img/checkbox-incorrect.svg">');
					}
				}

				//update the user input view
				function updateInput(){
					//remove text and allow user to type
					$('.title-2 p').html('Type what you remember.');
					$('.clock').remove();
					$('.grid').append('<div class="area submit-button"><img src="img/submit.svg"></div>');

					//update input field
					input.prop( "disabled", false ); //enable input
					input.val('');
					input.focus();

					//add listeners
					input.on("keypress", function(e){ 
						$('.submit-button').addClass('blink'); //enable blinking
						if (e.which == 13) checkAnswer();
					});
					$('.submit-button').on('click', function(){ checkAnswer(); });
				}

				//check the correct string value
				function checkAnswer(){
					if (input.val() == correctString){ localStorage.setItem("roundList", setCharAt(localStorage.getItem("roundList"), currentRound, 1)); }
					else { localStorage.setItem("roundList", setCharAt(localStorage.getItem("roundList"), currentRound, 2)); }
					currentRound += 1;
					localStorage.setItem('currentRound', currentRound);

					//go to next round or results page
					if (currentRound < rounds) location.reload();
					else location.href = 'results.html';
				}

				//replace session roundList chars
				function setCharAt(str,index,chr) {
					if(index > str.length-1) return str;
					return str.substr(0,index) + chr + str.substr(index+1);
				}
				
				play(); //initialize everything immediately
			});
		</script>
	</body>
</html>